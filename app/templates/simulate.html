<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Simulación de Eventos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://rsms.me/inter/inter.css');
        body {
            font-family: 'Inter', sans-serif;
        }
        #log-container p {
            margin-bottom: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .log-info { color: #9ca3af; }
        .log-success { color: #4ade80; }
        .log-error { color: #f87171; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6 md:p-10">
    
    < class="max-w-6xl mx-auto">
        
        <h1 class="text-3xl font-bold mb-4">Panel de Simulación de Eventos</h1>
        <p class="text-gray-400 mb-6">
            Envía eventos a API de FastAPI (<span id="base-url-display" class="font-mono"></span>)
        </p>

        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-3">Lanzamiento Concurrente</h2>
            <button id="send-all" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                Lanzar TODOS los eventos a la vez
            </button>
        </div>

        <hr class="border-gray-700 my-6">

        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Eventos Individuales</h2>
            <div id="individual-buttons" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            </div>
        </div>

        <hr class="border-gray-700 my-6">

        <div>
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-xl font-semibold">Consola de Resultados</h2>
                <button id="clear-log" class="text-sm text-gray-400 hover:text-white transition-colors">Limpiar</button>
            </div>
            <div id="log-container" class="bg-black rounded-lg p-4 h-80 overflow-y-auto shadow-inner">
            </div>
        </div>
        
        <a href="/home" class="inline-block mt-6 bg-indigo-600 hover:bg-indigo-500 px-6 py-3 rounded-lg font-semibold">Volver</a>
        

    </div>

    <script>
        const BASE_URL = "http://127.0.0.1:8000";

        const events_to_send = [
            { "name": "Acceso: Autorizado (ID001)", "url": "/sensor/access", "payload": {"badge_id": "ID001", "door": "Entrada Principal"} },
            { "name": "Acceso: No Autorizado (ID999)", "url": "/sensor/access", "payload": {"badge_id": "ID999", "door": "Sala de Servidores", "timestamp": new Date().toISOString()} },
            { "name": "Acceso: Alerta (Sin Badge)", "url": "/sensor/access", "payload": {"badge_id": null, "door": "Puerta Trasera"} },
            { "name": "Acceso: Alerta (Forzado)", "url": "/sensor/access", "payload": {"unauthorized_access": true, "door": "Ventana Oficina"} },
            { "name": "Movimiento: Alerta (No Autorizado)", "url": "/sensor/motion", "payload": {"movement": true, "zone": "Área Restringida", "authorized": false} },
            { "name": "Movimiento: Normal (Autorizado)", "url": "/sensor/motion", "payload": {"movement": true, "zone": "Lobby", "authorized": true, "timestamp": new Date().toISOString()} },
            { "name": "Movimiento: Normal (Sin Movimiento)", "url": "/sensor/motion", "payload": {"movement": false, "zone": "Pasillo 1"} },
            { "name": "Temp: Alerta (MUY ALTA)", "url": "/sensor/temperature", "payload": {"temperature": 41.5, "unit": "C", "sensor_id": "SENSOR-SALA-01"} },
            { "name": "Temp: Alerta (MUY BAJA)", "url": "/sensor/temperature", "payload": {"temperature": -5.0, "unit": "C", "sensor_id": "SENSOR-CONGELADOR"} },
            { "name": "Temp: Normal (Oficina)", "url": "/sensor/temperature", "payload": {"temperature": 22.0, "unit": "C", "sensor_id": "SENSOR-OFICINA", "timestamp": new Date().toISOString()} },
            { "name": "Temp: Normal (Fahrenheit)", "url": "/sensor/temperature", "payload": {"temperature": 85.0, "unit": "F", "sensor_id": "SENSOR-SALA-EEUU"} }
        ];

        const sendAllButton = document.getElementById('send-all');
        const buttonsContainer = document.getElementById('individual-buttons');
        const logContainer = document.getElementById('log-container');
        const clearLogButton = document.getElementById('clear-log');
        const baseUrlDisplay = document.getElementById('base-url-display');

        function addLog(message, type = 'info') {
            const p = document.createElement('p');
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            if (type === 'success') {
                p.className = 'log-success';
            } else if (type === 'error') {
                p.className = 'log-error';
            } else {
                p.className = 'log-info';
            }
            
            logContainer.appendChild(p);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        async function sendRequest(eventData) {
            const { url, payload, name } = eventData;
            
            if (payload.timestamp) {
                payload.timestamp = new Date().toISOString();
            }

            addLog(`Lanzando: ${name}...`, 'info');

            try {
                const response = await fetch(BASE_URL + url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.detail || `Error del servidor ${response.status}`);
                }
                
                const message = result.message || JSON.stringify(result);
                addLog(`ÉXITO [${name}]: ${message}`, 'success');

            } catch (err) {
                addLog(`ERROR [${name}]: ${err.message}. ¿El servidor está funcionando?`, 'error');
            }
        }

        function populateButtons() {
            events_to_send.forEach(eventData => {
                const button = document.createElement('button');
                button.textContent = eventData.name;
                button.className = "w-full bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-lg text-left transition-colors duration-200";
                
                button.onclick = () => sendRequest(eventData);
                
                buttonsContainer.appendChild(button);
            });
        }

        async function sendAllEvents() {
            addLog(`--- Lanzando TODOS (${events_to_send.length}) los eventos ---`, 'info');
            
            const tasks = events_to_send.map(eventData => sendRequest(eventData));
            
            await Promise.all(tasks);
            
            addLog('--- Simulación Concurrente Completa ---', 'info');
        }

        document.addEventListener('DOMContentLoaded', () => {
            sendAllButton.onclick = sendAllEvents;
            clearLogButton.onclick = () => {
                logContainer.innerHTML = '';
            };

            baseUrlDisplay.textContent = BASE_URL;

            populateButtons();
            
        });

    </script>
</body>
</html>

